<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Works On Analysis</title>
    <!-- Bootswatch Cerulean Theme for styling -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/cerulean/bootstrap.min.css">
    <style>
        /* General content and layout styles */
        .content-section { padding: 2rem 0; }
        .feature-box { padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; background-color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .search-box { margin-bottom: 1rem; } /* Search input box styling */
        .error-message { color: red; font-size: 1.1rem; text-align: center; } /* Error message styling */
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">TCSS 445 | Assign4</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <!-- Navigation links -->
                    <li class="nav-item"><a class="nav-link" href="employee.html">Employee</a></li>
                    <li class="nav-item"><a class="nav-link" href="department.html">Department</a></li>
                    <li class="nav-item"><a class="nav-link" href="project.html">Project</a></li>
                    <li class="nav-item"><a class="nav-link active" href="worksOn.html">Works On</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content Section -->
    <div class="content-section">
        <div class="container">
            <h2>Works On Analysis</h2>

            <!-- Search Box -->
            <div class="search-box">
                <input type="text" id="searchInput" class="form-control" placeholder="Search work data..." onkeyup="filterTable()">
            </div>

            <!-- Collapsible Tables for Analysis -->
            <div class="accordion" id="worksOnAccordion">

                <!-- Hours Worked Analysis Section -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                            Hours Worked Analysis
                        </button>
                    </h2>
                    <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#worksOnAccordion">
                        <div class="accordion-body">
                            <table class="table table-bordered table-striped" id="hoursTable">
                                <thead class="table-dark">
                                    <tr>
                                        <th onclick="sortTable(0, 'hoursTable')">Employee ID</th>
                                        <th onclick="sortTable(1, 'hoursTable')">Employee Name</th>
                                        <th onclick="sortTable(2, 'hoursTable')">Total Hours Worked</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Project Participation Metrics Section -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingTwo">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                            Project Participation Metrics
                        </button>
                    </h2>
                    <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#worksOnAccordion">
                        <div class="accordion-body">
                            <table class="table table-bordered table-striped" id="participationTable">
                                <thead class="table-dark">
                                    <tr>
                                        <th onclick="sortTable(0, 'participationTable')">Project Name</th>
                                        <th onclick="sortTable(1, 'participationTable')">Number of Participants</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Employee Workload Distribution Section -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingThree">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                            Employee Workload Distribution
                        </button>
                    </h2>
                    <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#worksOnAccordion">
                        <div class="accordion-body">
                            <table class="table table-bordered table-striped" id="workloadTable">
                                <thead class="table-dark">
                                    <tr>
                                        <th onclick="sortTable(0, 'workloadTable')">Employee ID</th>
                                        <th onclick="sortTable(1, 'workloadTable')">Employee Name</th>
                                        <th onclick="sortTable(2, 'workloadTable')">Department Name</th>
                                        <th onclick="sortTable(3, 'workloadTable')">Total Hours Worked</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Cross-Department Collaboration Section -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingFour">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                            Cross-Department Collaboration
                        </button>
                    </h2>
                    <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#worksOnAccordion">
                        <div class="accordion-body">
                            <table class="table table-bordered table-striped" id="collaborationTable">
                                <thead class="table-dark">
                                    <tr>
                                        <th onclick="sortTable(0, 'collaborationTable')">Project Number</th>
                                        <th onclick="sortTable(1, 'collaborationTable')">Project Name</th>
                                        <th onclick="sortTable(2, 'collaborationTable')">Total Collaborators</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="error-message d-none">Error loading data. Please try again later.</div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light mt-5 py-3">
        <div class="container text-center">
            <p class="text-muted">TCSS 445 - Database Systems Design Â© 2024</p>
        </div>
    </footer>

    <!-- JavaScript Section -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Fetch data and populate tables
        document.addEventListener('DOMContentLoaded', async () => {
            const errorMessage = document.getElementById('errorMessage');
            try {
                await fetchAndPopulate('/worksOn/hours-worked', 'hoursTable', ['EmployeeID', 'EmployeeName', 'TotalHoursWorked']);
                await fetchAndPopulate('/worksOn/participation-metrics', 'participationTable', ['ProjectName', 'NumberOfParticipants']);
                await fetchAndPopulate('/worksOn/workload-distribution', 'workloadTable', ['EmployeeID', 'EmployeeName', 'DepartmentName', 'TotalHoursWorked']);
                await fetchAndPopulate('/worksOn/cross-department-collaboration', 'collaborationTable', ['ProjectNumber', 'ProjectName', 'TotalCollaborators']);
            } catch (err) {
                console.error('Error loading data:', err);
                errorMessage.classList.remove('d-none');
            }
        });

        // Function to fetch data and populate a specific table
        const fetchAndPopulate = async (endpoint, tableId, columns) => {
            const response = await fetch(endpoint);
            const data = await response.json();
            const tableBody = document.querySelector(`#${tableId} tbody`);
            tableBody.innerHTML = '';
            data.forEach(row => {
                const tr = document.createElement('tr');
                columns.forEach(col => {
                    const td = document.createElement('td');
                    td.textContent = row[col] || 'N/A';
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            });
        };

        // Search functionality for filtering rows across all tables
        const filterTable = () => {
            const input = document.getElementById('searchInput').value.toLowerCase();
            const tables = document.querySelectorAll('.table tbody');
            tables.forEach(table => {
                table.querySelectorAll('tr').forEach(row => {
                    const rowText = Array.from(row.children).map(td => td.textContent.toLowerCase()).join(' ');
                    row.style.display = rowText.includes(input) ? '' : 'none';
                });
            });
        };

        // Sorting functionality for table columns
        const sortTable = (columnIndex, tableId) => {
            const table = document.getElementById(tableId);
            const rows = Array.from(table.querySelectorAll('tbody tr'));
            const isAscending = table.getAttribute('data-sort') === 'asc';
            rows.sort((a, b) => {
                const valA = a.children[columnIndex].textContent.trim();
                const valB = b.children[columnIndex].textContent.trim();
                return isAscending ? valA.localeCompare(valB) : valB.localeCompare(valA);
            });
            rows.forEach(row => table.querySelector('tbody').appendChild(row));
            table.setAttribute('data-sort', isAscending ? 'desc' : 'asc');
        };
    </script>
</body>
</html>

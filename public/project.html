<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Management</title>
    <!-- Import Bootswatch Cerulean theme for consistent styling -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/cerulean/bootstrap.min.css">
    <style>
        /* General styling for the content sections and feature boxes */
        .content-section { padding: 2rem 0; }
        .feature-box { padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; background-color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .search-box { margin-bottom: 1rem; } /* Styling for the search input box */
        .status-in-progress { background-color: #d4edda; color: #155724; } /* Green background for 'In Progress' status */
        .status-not-started { background-color: #f8d7da; color: #721c24; } /* Red background for 'Not Started' status */
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">TCSS 445 | Assign4</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <!-- Navigation links -->
                    <li class="nav-item"><a class="nav-link" href="employee.html">Employee</a></li>
                    <li class="nav-item"><a class="nav-link" href="department.html">Department</a></li>
                    <li class="nav-item"><a class="nav-link active" href="project.html">Project</a></li>
                    <li class="nav-item"><a class="nav-link" href="worksOn.html">Works On</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content Section -->
    <div class="content-section">
        <div class="container">
            <h2>Project Management</h2>

            <!-- Search Box for filtering projects -->
            <div class="search-box">
                <input type="text" id="searchInput" class="form-control" placeholder="Search projects..." onkeyup="filterTable()">
            </div>

            <!-- Project Duration Analysis Section -->
            <div class="feature-box">
                <h3>Project Hours Analysis</h3>
                <table class="table table-bordered table-striped table-responsive" id="duration-table">
                    <thead class="table-dark">
                        <tr>
                            <th>Project Name</th>
                            <th>Total Hours Worked</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Resource Allocation Section -->
            <div class="feature-box">
                <h3>Resource Allocation</h3>
                <table class="table table-bordered table-striped table-responsive" id="resource-table">
                    <thead class="table-dark">
                        <tr>
                            <th>Project Name</th>
                            <th>Total Employees Assigned</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Project Completion Status Section -->
            <div class="feature-box">
                <h3>Project Completion Status</h3>
                <table class="table table-bordered table-striped table-responsive" id="status-table">
                    <thead class="table-dark">
                        <tr>
                            <th>Project Name</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Employee Assignments Section -->
            <div class="feature-box">
                <h3>Employee Assignments</h3>
                <table class="table table-bordered table-striped table-responsive" id="assignments-table">
                    <thead class="table-dark">
                        <tr>
                            <th>Project Name</th>
                            <th>Employee Name</th>
                            <th>Assigned Hours</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- JavaScript Section -->
    <script>
        /**
         * Fetch data from the server and populate tables.
         * On page load, this function fetches data for all four sections and displays it.
         */
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Fetch and populate data for all sections
                const durationData = await fetch('/project/duration-analysis').then(res => res.json());
                populateTable('duration-table', durationData, ['ProjectName', 'TotalHoursWorked']);

                const resourceData = await fetch('/project/resource-allocation').then(res => res.json());
                populateTable('resource-table', resourceData, ['ProjectName', 'TotalEmployees']);

                const statusData = await fetch('/project/completion-status').then(res => res.json());
                populateTable('status-table', statusData, ['ProjectName', 'Status'], true);

                const assignmentsData = await fetch('/project/employee-assignments').then(res => res.json());
                populateTable('assignments-table', assignmentsData, ['ProjectName', 'EmployeeName', 'AssignedHours']);
            } catch (err) {
                console.error('Error fetching data:', err);
            }
        });

        /**
         * Populates a table with data from the server.
         * @param {string} tableId - ID of the table to populate.
         * @param {Array} data - Data to populate the table with.
         * @param {Array} columns - Array of column keys to extract from data.
         * @param {boolean} colorCodeStatus - Whether to apply status color coding (default: false).
         */
        function populateTable(tableId, data, columns, colorCodeStatus = false) {
            const tableBody = document.getElementById(tableId).querySelector('tbody');
            tableBody.innerHTML = ''; // Clear existing rows
            data.forEach(row => {
                const tr = document.createElement('tr');
                columns.forEach(col => {
                    const td = document.createElement('td');
                    td.textContent = row[col] || 'N/A';
                    // Apply color coding for project status
                    if (colorCodeStatus && col === 'Status') {
                        td.className = row[col] === 'In Progress' ? 'status-in-progress' : 'status-not-started';
                    }
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            });
        }

        /**
         * Filters table rows based on user input in the search box.
         */
        function filterTable() {
            const input = document.getElementById('searchInput').value.toLowerCase();
            const tables = document.querySelectorAll('.table tbody');
            tables.forEach(table => {
                table.querySelectorAll('tr').forEach(row => {
                    const rowText = Array.from(row.children).map(td => td.textContent.toLowerCase()).join(' ');
                    row.style.display = rowText.includes(input) ? '' : 'none';
                });
            });
        }
    </script>
</body>
</html>
